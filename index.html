<!DOCTYPE html>
<html lang="es">
  <head>
    <meta
      charset="UTF-8"
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>TestLab - Aplicación de Tests</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
  </head>
  <body>
    <script src="https://cdn.lordicon.com/lordicon.js"></script>

    <!-- Particles Background -->
    <div class="particles-container" id="particles-container"></div>

    <div id="app">
      <!-- Loading Screen -->
      <div id="loading-screen" class="screen active">
        <div class="loading-container">
          <div class="loading-spinner"></div>
          <h2>Cargando TestLab...</h2>
        </div>
      </div>

      <!-- Subject Selection Screen -->
      <div id="subject-screen" class="screen">
        <div class="container">
          <header class="header">
            <div class="header-title-container">
              <h1>TestLab</h1>
              <img
                src="assets/hello-kitty-donut-hello-kitty.gif"
                alt="Hello Kitty Teacher"
                class="header-kitty"
              />
            </div>
            <p>Selecciona una materia para comenzar.</p>
          </header>
          <div class="subjects-grid" id="subjects-grid">
            <!-- Subjects will be loaded dynamically -->
          </div>
        </div>
      </div>

      <!-- Test Type Selection Screen -->
      <div id="test-type-screen" class="screen">
        <div class="container">
          <header class="header">
            <button class="back-button" id="back-to-subjects">
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="m15 18-6-6 6-6" />
              </svg>
              Volver
            </button>
            <h1 id="selected-subject-title">Materia Seleccionada</h1>
            <p>Selecciona el tipo de test que quieres realizar</p>
          </header>
          <div class="test-types-grid">
            <div class="test-type-card" data-type="sequential">
              <div class="card-icon">
                <lord-icon
                  src="https://cdn.lordicon.com/wxnxiano.json"
                  trigger="hover"
                  style="width: 100px; height: 100px"
                >
                </lord-icon>
              </div>
              <h3>Test Secuencial</h3>
              <p>Preguntas en orden, ideal para estudio progresivo</p>
            </div>
            <div class="test-type-card" data-type="random">
              <div class="card-icon">
                <lord-icon
                  src="https://cdn.lordicon.com/slkvcfos.json"
                  trigger="hover"
                  style="width: 100px; height: 100px"
                >
                </lord-icon>
              </div>
              <h3>Test Aleatorio</h3>
              <p>Preguntas en orden aleatorio para práctica general</p>
            </div>
            <div class="test-type-card" data-type="errors">
              <div class="card-icon">
                <lord-icon
                  src="https://cdn.lordicon.com/tdrtiskw.json"
                  trigger="hover"
                  style="width: 100px; height: 100px"
                >
                </lord-icon>
              </div>
              <h3>Test de Errores</h3>
              <p>Solo preguntas que has fallado anteriormente</p>
            </div>
            <div class="test-type-card" data-type="timed">
              <div class="card-icon">
                <lord-icon
                  src="https://cdn.lordicon.com/qznlhdss.json"
                  trigger="hover"
                  style="width: 100px; height: 100px"
                >
                </lord-icon>
              </div>
              <h3>Test Cronometrado</h3>
              <p>Modo examen con tiempo limitado por pregunta</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Test Configuration Screen -->
      <div id="test-config-screen" class="screen">
        <div class="container">
          <header class="header">
            <button class="back-button" id="back-to-test-types-config">
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="m15 18-6-6 6-6" />
              </svg>
              Volver
            </button>
            <h1 id="config-test-title">Configurar Test</h1>
            <p id="config-test-subtitle">Ajusta los parámetros del test</p>
          </header>

          <div class="config-content">
            <div class="config-card">
              <!-- Configuración para test secuencial -->
              <div
                id="sequential-config"
                class="config-section"
                style="display: none"
              >
                <h3>Selecciona el rango de preguntas</h3>
                <div class="range-selector">
                  <div class="range-option">
                    <label>Desde pregunta:</label>
                    <input
                      type="number"
                      id="range-start"
                      min="1"
                      value="1"
                      class="range-input"
                    />
                  </div>
                  <div class="range-option">
                    <label>Hasta pregunta:</label>
                    <input
                      type="number"
                      id="range-end"
                      min="1"
                      value="10"
                      class="range-input"
                    />
                  </div>
                </div>
                <div class="range-info">
                  <p>
                    Total de preguntas seleccionadas:
                    <span id="selected-count">10</span>
                  </p>
                  <p class="range-note">
                    Máximo disponible:
                    <span id="max-questions">20</span> preguntas
                  </p>
                </div>
              </div>

              <!-- Configuración para test aleatorio -->
              <div
                id="random-config"
                class="config-section"
                style="display: none"
              >
                <h3>Selecciona la cantidad de preguntas</h3>
                <div class="quantity-selector">
                  <div class="quantity-buttons">
                    <button class="quantity-btn" data-quantity="5">
                      5 preguntas
                    </button>
                    <button class="quantity-btn" data-quantity="10">
                      10 preguntas
                    </button>
                    <button class="quantity-btn active" data-quantity="15">
                      15 preguntas
                    </button>
                    <button class="quantity-btn" data-quantity="30">
                      30 preguntas
                    </button>
                    <button class="quantity-btn" data-quantity="all">
                      Todas
                    </button>
                  </div>
                  <div class="custom-quantity">
                    <label>O elige una cantidad personalizada:</label>
                    <input
                      type="number"
                      id="custom-quantity"
                      min="1"
                      placeholder="Ej: 8"
                      class="range-input"
                    />
                  </div>
                </div>
                <div class="quantity-info">
                  <p>
                    Preguntas seleccionadas:
                    <span id="random-selected-count">15</span>
                  </p>
                  <p class="range-note">
                    Disponibles:
                    <span id="random-max-questions">20</span> preguntas
                  </p>
                </div>
              </div>

              <!-- Configuración para test de errores -->
              <div
                id="errors-config"
                class="config-section"
                style="display: none"
              >
                <div class="errors-info">
                  <h3>Test de Errores</h3>
                  <p>
                    Este test incluirá solo las preguntas que has respondido
                    incorrectamente en sesiones anteriores.
                  </p>
                  <div class="errors-stats">
                    <div class="stat">
                      <strong id="error-questions-count">0</strong>
                      <span>Preguntas con errores</span>
                    </div>
                  </div>
                  <div class="errors-note">
                    <p class="range-note">
                      💡 Si es tu primera vez, se incluirán todas las preguntas
                      para crear tu base de errores.
                    </p>
                  </div>
                </div>
              </div>

              <!-- Configuración para test cronometrado -->
              <div
                id="timed-config"
                class="config-section"
                style="display: none"
              >
                <h3>Configurar test cronometrado</h3>
                <div class="timed-options">
                  <div class="timed-group">
                    <label>Cantidad de preguntas:</label>
                    <select id="timed-questions" class="timed-select">
                      <option value="5">5 preguntas</option>
                      <option value="10" selected>10 preguntas</option>
                      <option value="15">15 preguntas</option>
                      <option value="20">20 preguntas</option>
                    </select>
                  </div>
                  <div class="timed-group">
                    <label>Tiempo por pregunta:</label>
                    <select id="time-per-question" class="timed-select">
                      <option value="15">15 segundos</option>
                      <option value="30" selected>30 segundos</option>
                      <option value="45">45 segundos</option>
                      <option value="60">1 minuto</option>
                    </select>
                  </div>
                </div>
                <div class="timed-info">
                  <p>
                    Tiempo total estimado: <span id="total-time">5:00</span>
                  </p>
                  <p class="range-note">
                    ⏰ Una vez que empieces, no podrás pausar el test
                  </p>
                </div>
              </div>
            </div>

            <div class="config-actions">
              <button id="start-configured-test" class="primary-button">
                Comenzar Test
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="m9 18 6-6-6-6" />
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Test Taking Screen -->
      <div id="test-screen" class="screen">
        <div class="container">
          <header class="test-header">
            <div class="header-row-1">
              <button
                class="back-button"
                id="back-to-test-types"
                title="Volver a tipos de test"
              >
                <svg
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                  <polyline points="16,17 21,12 16,7" />
                  <line x1="21" y1="12" x2="9" y2="12" />
                </svg>
              </button>
              <div class="test-info">
                <div class="test-progress">
                  <span id="current-question">1</span> /
                  <span id="total-questions">10</span>
                </div>
                <div class="progress-bar-container">
                  <div class="progress-bar" id="progress-bar"></div>
                </div>
              </div>
              <div class="test-timer" id="test-timer">
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <circle cx="12" cy="12" r="10" />
                  <polyline points="12,6 12,12 16,14" />
                </svg>
                <span id="timer-display">00:30</span>
              </div>
            </div>
            <div class="header-row-2">
              <button
                class="nav-button"
                id="prev-question"
                disabled
                title="Pregunta anterior"
              >
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="m15 18-6-6 6-6" />
                </svg>
              </button>
              <div class="question-status-grid" id="question-status-grid">
                <!-- Los 3 botones de estado de preguntas se generarán dinámicamente -->
              </div>
              <button
                class="nav-button"
                id="next-question-header"
                disabled
                title="Siguiente pregunta"
              >
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="m9 18 6-6-6-6" />
                </svg>
              </button>
            </div>
          </header>

          <div class="test-content">
            <div class="question-card">
              <h2 id="question-text">Pregunta aparecerá aquí</h2>
              <div id="question-gif-container" class="question-gif-container">
                <img
                  id="question-gif"
                  src="assets/helocuti-hihihuhu.gif"
                  alt="Hello Kitty GIF"
                  class="question-gif"
                />
              </div>
            </div>

            <div class="answers-container" id="answers-container">
              <!-- Answers will be generated dynamically -->
            </div>

            <div
              class="question-explanation"
              id="question-explanation"
              style="display: none"
            >
              <h4>Explicación:</h4>
              <p id="explanation-text"></p>
            </div>

            <div class="test-actions">
              <button
                id="show-explanation"
                class="secondary-button"
                style="display: none"
              >
                Ver Explicación
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Results Screen -->
      <div id="results-screen" class="screen">
        <div class="container">
          <div class="results-content">
            <div class="results-header">
              <div class="results-icon" id="results-icon">
                <img
                  src="assets/hello-kitty-pixel-art.gif"
                  alt="Hello Kitty Pixel Art"
                  class="results-gif"
                />
              </div>
              <h1 id="results-title">¡Test Completado!</h1>
            </div>

            <div class="results-stats">
              <div class="stat-card">
                <div class="stat-value" id="score-percentage">85%</div>
                <div class="stat-label">Puntuación</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="correct-answers">17/20</div>
                <div class="stat-label">Respuestas Correctas</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="time-taken">05:23</div>
                <div class="stat-label">Tiempo Empleado</div>
              </div>
            </div>

            <div class="results-actions">
              <button id="restart-test" class="secondary-button">
                Repetir Test
              </button>
              <button id="back-to-subjects-final" class="primary-button">
                Volver a Materias
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- JavaScript Modules -->
    <script src="js/utils.js"></script>
    <script src="js/screen-manager.js"></script>
    <script src="js/timer-manager.js"></script>
    <script src="js/question-manager.js"></script>
    <script src="js/navigation-manager.js"></script>
    <script src="js/app.js"></script>

    <!-- Script para prevenir zoom -->
    <script>
      // Prevenir zoom con doble tap
      let lastTouchEnd = 0;
      document.addEventListener(
        "touchend",
        function (event) {
          const now = new Date().getTime();
          if (now - lastTouchEnd <= 300) {
            event.preventDefault();
          }
          lastTouchEnd = now;
        },
        false
      );

      // Prevenir zoom con gestos de pellizco
      document.addEventListener("gesturestart", function (event) {
        event.preventDefault();
      });

      document.addEventListener("gesturechange", function (event) {
        event.preventDefault();
      });

      document.addEventListener("gestureend", function (event) {
        event.preventDefault();
      });

      // Prevenir zoom con rueda del ratón + Ctrl
      document.addEventListener(
        "wheel",
        function (event) {
          if (event.ctrlKey) {
            event.preventDefault();
          }
        },
        { passive: false }
      );

      // Prevenir zoom con teclado (Ctrl + / Ctrl -)
      document.addEventListener("keydown", function (event) {
        if (
          event.ctrlKey &&
          (event.keyCode === 107 ||
            event.keyCode === 109 ||
            event.keyCode === 187 ||
            event.keyCode === 189)
        ) {
          event.preventDefault();
        }
      });
    </script>
  </body>
</html>
